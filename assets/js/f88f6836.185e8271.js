"use strict";(self.webpackChunksqliste_doc=self.webpackChunksqliste_doc||[]).push([[2297],{9868:(e,n,t)=>{t.d(n,{Zo:()=>c,kt:()=>k});var r=t(6687);function o(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function i(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function s(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?i(Object(t),!0).forEach((function(n){o(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):i(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function a(e,n){if(null==e)return{};var t,r,o=function(e,n){if(null==e)return{};var t,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)t=i[r],n.indexOf(t)>=0||(o[t]=e[t]);return o}(e,n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)t=i[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(o[t]=e[t])}return o}var u=r.createContext({}),l=function(e){var n=r.useContext(u),t=n;return e&&(t="function"==typeof e?e(n):s(s({},n),e)),t},c=function(e){var n=l(e.components);return r.createElement(u.Provider,{value:n},e.children)},p="mdxType",d={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},m=r.forwardRef((function(e,n){var t=e.components,o=e.mdxType,i=e.originalType,u=e.parentName,c=a(e,["components","mdxType","originalType","parentName"]),p=l(t),m=o,k=p["".concat(u,".").concat(m)]||p[m]||d[m]||i;return t?r.createElement(k,s(s({ref:n},c),{},{components:t})):r.createElement(k,s({ref:n},c))}));function k(e,n){var t=arguments,o=n&&n.mdxType;if("string"==typeof e||o){var i=t.length,s=new Array(i);s[0]=m;var a={};for(var u in n)hasOwnProperty.call(n,u)&&(a[u]=n[u]);a.originalType=e,a[p]="string"==typeof e?e:o,s[1]=a;for(var l=2;l<i;l++)s[l]=t[l];return r.createElement.apply(null,s)}return r.createElement.apply(null,t)}m.displayName="MDXCreateElement"},1973:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>u,contentTitle:()=>s,default:()=>d,frontMatter:()=>i,metadata:()=>a,toc:()=>l});var r=t(8792),o=(t(6687),t(9868));const i={sidebar_position:1},s="Cookies",a={unversionedId:"intregrations/sql-server/http-operations/cookies",id:"intregrations/sql-server/http-operations/cookies",title:"Cookies",description:"Un cookie est une donn\xe9e stock\xe9e dans le navigateur, g\xe9n\xe9ralement limit\xe9e \xe0 4ko, et qui sera jointe \xe0 chaque requ\xeate.",source:"@site/docs/intregrations/sql-server/http-operations/cookies.md",sourceDirName:"intregrations/sql-server/http-operations",slug:"/intregrations/sql-server/http-operations/cookies",permalink:"/docs/intregrations/sql-server/http-operations/cookies",draft:!1,editUrl:"https://github.com/corentin703/sqliste/tree/doc/docs/intregrations/sql-server/http-operations/cookies.md",tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1},sidebar:"docSidebar",previous:{title:"Op\xe9rations sur HTTP",permalink:"/docs/category/op\xe9rations-sur-http"},next:{title:"En-t\xeate HTTP",permalink:"/docs/intregrations/sql-server/http-operations/headers"}},u={},l=[{value:"Lecture",id:"lecture",level:2},{value:"\xc9criture",id:"\xe9criture",level:2}],c={toc:l},p="wrapper";function d(e){let{components:n,...t}=e;return(0,o.kt)(p,(0,r.Z)({},c,t,{components:n,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"cookies"},"Cookies"),(0,o.kt)("p",null,"Un cookie est une donn\xe9e stock\xe9e dans le navigateur, g\xe9n\xe9ralement limit\xe9e \xe0 4ko, et qui sera jointe \xe0 chaque requ\xeate.",(0,o.kt)("br",null),"\nIls permettent par exemple de m\xe9moriser des pr\xe9f\xe9rences utilisateurs, ou encore de faire le lien entre un utilisateur et sa session HTTP."),(0,o.kt)("h2",{id:"lecture"},"Lecture"),(0,o.kt)("p",null,"Les cookies peuvent-\xeatre lu dans un dictionnaire cl\xe9/valeur disponible dans le param\xe8tre standard ",(0,o.kt)("em",{parentName:"p"},"request_cookies"),".",(0,o.kt)("br",null),"\nLa cl\xe9 correspondra au nom de votre cookie, et la valeur \xe0 la donn\xe9e contenue dedans."),(0,o.kt)("p",null,"Exemple de lecture : un cookie comptant le nombre de requ\xeates de l'utilisateur."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sql"},'#Route("/api/exemple/cookie")\n#HttpGet("ExempleCookie")\nCREATE OR ALTER PROCEDURE [web].[p_exemple_cookie]\n    @request_cookies NVARCHAR(MAX) \nAS \nBEGIN\n    DECLARE @visit_counter BIGINT;\n    \n    -- On r\xe9cup\xe8re la valeur du cookie nomm\xe9 "visitCounter"\n    SET @visit_counter = ISNULL(JSON_VALUE(@request_cookies, \'$.visitCounter\'), 0) + 1;\n\n    IF (@visit_counter = 1)\n    BEGIN\n        SELECT \n             \'{ "message": "C\'\'est votre premi\xe8re visite. Soyez le bienvenu !" }\' AS [response_body]\n            ,200 AS [response_status]\n        ;\n        RETURN;\n    END \n\n    SELECT \n         \'{ "message": "C\'\'est votre visite n\xb0\' + @visit_counter + \' !" }\' AS [response_body]\n        ,200 AS [response_status]\n    ;\nEND\nGO\n')),(0,o.kt)("h2",{id:"\xe9criture"},"\xc9criture"),(0,o.kt)("p",null,"Pour \xe9crire, ou alt\xe9rer un cookie, il faut alt\xe9rer le param\xe8tre ",(0,o.kt)("em",{parentName:"p"},"response_cookies"),".",(0,o.kt)("br",null),"\nContrairement \xe0 la lecture, il ne s'agit pas d'un dictionnaire, mais d'un tableau de param\xe8tres, permettant de d\xe9finir plusieurs propri\xe9t\xe9s aux cookies."),(0,o.kt)("p",null,"Description d'un param\xe9trage de cookie :"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json",metastring:"lines",lines:!0},'{\n  "name": "nom",\n  "value": "valeur",\n  "expires": "2023-06-12T00:00:00", // Date d\'expiration au format [ISO 8601](https://fr.wikipedia.org/wiki/ISO_8601)\n  "domain": "Domaine de validit\xe9", // Par d\xe9faut le domaine correspondant \xe0 l\'origine. Vous pouvez d\xe9finir votre domaine racine pour inclure tous vos sous-domaines. Si vous mettez un autre domaine, gardez en t\xeate que les cookies _cross-origin_ \xe9tant en passe de disparaitre.\n  "path": "/api/exemple", // Le cookie ne sera envoy\xe9 que si la route commence par /api/exemple\n  "secure": true, // Le cookie ne sera envoy\xe9 que lorsque la connexion sera en HTTPS\n  "sameSite": "Lax", // Permet de d\xe9finir la politique d\'envoie du cookie lors de requ\xeates vers d\'autres sites\n  "httpOnly": false, // Rend le cookie inaccessible via du JavaScript\n  "maxAge": 3600 // Dur\xe9e de vie maximum du cookie (exprim\xe9 en secondes), compl\xe9mentaire du param\xe8tre _expires_, qui lui prend une date\n}\n')),(0,o.kt)("p",null,"Pour en savoir plus sur les cookies, ainsi que les possibilit\xe9s de ces param\xe8tres, vous pouvez consulter cette ",(0,o.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/fr/docs/Web/HTTP/Cookies"},"ressource")," qui d\xe9taille l'utilit\xe9 de chacun.",(0,o.kt)("br",null),"\nLes param\xe8tres obligatoires dans ce mod\xe8le sont ",(0,o.kt)("inlineCode",{parentName:"p"},"name")," et ",(0,o.kt)("inlineCode",{parentName:"p"},"value")," ainsi que ",(0,o.kt)("inlineCode",{parentName:"p"},"expires")," ou ",(0,o.kt)("inlineCode",{parentName:"p"},"maxAge")," au choix."),(0,o.kt)("p",null,"Reprenons notre exemple pr\xe9c\xe9dent, en y ajoutant le code n\xe9cessaire pour d\xe9finir le cookie s'il n'existe pas, ou le mettre \xe0 jour."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sql"},"#Route(\"/api/exemple/cookie\")\n#HttpGet(\"ExempleCookie\")\nCREATE OR ALTER PROCEDURE [web].[p_exemple_cookie]\n    @request_cookies NVARCHAR(MAX),\n    @response_cookies NVARCHAR(MAX)\nAS \nBEGIN\n    DECLARE @visit_counter BIGINT;\n    DECLARE @visit_counter_cookie NVARCHAR(MAX);\n    \n    -- On r\xe9cup\xe8re la valeur actuelle\n    SET @visit_counter = ISNULL(JSON_VALUE(@request_cookies, '$.visitCounter'), 0) + 1;\n\n    -- On param\xe8tre notre cookie\n    SET @visit_counter_cookie = (\n        SELECT \n            'visitCounter' AS [name],\n            3600 * 24 * 7 AS [maxAge],\n            @visit_counter AS [value]\n        FOR JSON PATH\n    );\n    \n    -- FOR JSON PATH retournant syst\xe8matiquement un tableau, on r\xe9cup\xe8re le premier \xe9l\xe9ment (le seul existant ici)\n    SET @visit_counter_cookie = JSON_QUERY(@visit_counter_cookie, '$[0]');\n\n    -- On l'ajoute \xe0 la liste des cookies que l'on souhaite alt\xe9rer\n    SET @response_cookies = JSON_MODIFY(@response_cookies, 'append $', @visit_counter_cookie); \n\n    IF (@visit_counter = 1)\n    BEGIN\n        SELECT \n             '{ \"message\": \"C''est votre premi\xe8re visite. Soyez le bienvenu !\" }' AS [response_body]\n            ,200 AS [response_status]\n            ,@response_cookies AS [response_cookies]\n        ;\n        RETURN;\n    END \n\n    SELECT \n         '{ \"message\": \"C''est votre visite n\xb0' + @visit_counter + ' !\" }' AS [response_body]\n        ,200 AS [response_status]\n        ,@response_cookies AS [response_cookies]\n    ;\nEND\nGO\n")))}d.isMDXComponent=!0}}]);