"use strict";(self.webpackChunksqliste_doc=self.webpackChunksqliste_doc||[]).push([[4839],{9868:(e,t,n)=>{n.d(t,{Zo:()=>d,kt:()=>h});var r=n(6687);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var l=r.createContext({}),p=function(e){var t=r.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},d=function(e){var t=p(e.components);return r.createElement(l.Provider,{value:t},e.children)},m="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},c=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,l=e.parentName,d=s(e,["components","mdxType","originalType","parentName"]),m=p(n),c=a,h=m["".concat(l,".").concat(c)]||m[c]||u[c]||o;return n?r.createElement(h,i(i({ref:t},d),{},{components:n})):r.createElement(h,i({ref:t},d))}));function h(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,i=new Array(o);i[0]=c;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s[m]="string"==typeof e?e:a,i[1]=s;for(var p=2;p<o;p++)i[p]=n[p];return r.createElement.apply(null,i)}return r.createElement.apply(null,n)}c.displayName="MDXCreateElement"},485:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>i,default:()=>u,frontMatter:()=>o,metadata:()=>s,toc:()=>p});var r=n(8792),a=(n(6687),n(9868));const o={sidebar_position:3},i="Set up a Controller",s={unversionedId:"intregrations/sql-server/define-controller",id:"intregrations/sql-server/define-controller",title:"Set up a Controller",description:"A controller takes the form of a stored procedure located in the web schema.",source:"@site/docs/intregrations/sql-server/define-controller.md",sourceDirName:"intregrations/sql-server",slug:"/intregrations/sql-server/define-controller",permalink:"/sqliste/docs/intregrations/sql-server/define-controller",draft:!1,editUrl:"https://github.com/corentin703/sqliste/tree/main/doc/docs/intregrations/sql-server/define-controller.md",tags:[],version:"current",sidebarPosition:3,frontMatter:{sidebar_position:3},sidebar:"docSidebar",previous:{title:"Structure",permalink:"/sqliste/docs/intregrations/sql-server/structure"},next:{title:"Define a Middleware",permalink:"/sqliste/docs/intregrations/sql-server/define-middleware"}},l={},p=[{value:"Param\xe8tres d&#39;URI",id:"param\xe8tres-duri",level:2},{value:"Route Parameters",id:"route-parameters",level:2}],d={toc:p},m="wrapper";function u(e){let{components:t,...n}=e;return(0,a.kt)(m,(0,r.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"set-up-a-controller"},"Set up a Controller"),(0,a.kt)("p",null,"A controller takes the form of a stored procedure located in the ",(0,a.kt)("inlineCode",{parentName:"p"},"web")," schema."),(0,a.kt)("p",null,"Here is an example of a basic controller:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sql"},"-- #Route(\"/api/helloWorld\")\n-- #HttpGet(\"HelloWorld\")\nCREATE OR ALTER PROCEDURE [web].[p_hello_world] \nAS \nBEGIN\n    SELECT \n         'Greetings, everyone!' AS [response_body] -- Returning the response body\n        ,'text/plain' AS [response_content_type] -- MIME type of the response body\n        ,200 AS [response_status] -- HTTP status of the response\n    ;\nEND\nGO\n")),(0,a.kt)("h2",{id:"param\xe8tres-duri"},"Param\xe8tres d'URI"),(0,a.kt)("p",null,"A URI parameter is an argument provided as follows in a URI: ",(0,a.kt)("inlineCode",{parentName:"p"},"/api/exemple?name=Corentin"),(0,a.kt)("br",null),"\nTo retrieve its value, simply include it as an argument in the stored procedure:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sql"},"-- Define the 'name' parameter in the route using curly braces\n-- #Route(\"/api/helloWorld\")\n-- #HttpGet(\"HelloWorld\")\nCREATE OR ALTER PROCEDURE [web].[p_hello_world] \n    @name NVARCHAR(100) = NULL -- Retrieve the 'name' URI parameter\nAS \nBEGIN\n    DECLARE @response_body NVARCHAR(MAX);\n    \n    IF (@name IS NULL)\n        SET @response_body = 'Greetings, everyone!';\n    ELSE    \n        SELECT @response_body = 'Greetings, ' + @name + '!';\n        \n    SELECT \n         @response_body AS [response_body]\n        ,'text/plain' AS [response_content_type]\n        ,200 AS [response_status]\n    ;\nEND\nGO\n")),(0,a.kt)("p",null,"A URI parameter is always considered optional and should be of type ",(0,a.kt)("em",{parentName:"p"},"NVARCHAR")," (you can cast it to another type within the stored procedure if needed)."),(0,a.kt)("admonition",{type:"caution"},(0,a.kt)("p",{parentName:"admonition"},"It is recommended to provide a default value for URI parameters and optional route parameters in the stored procedure arguments. If no default value is provided and the parameter is not provided in the URI, the database will not be able to execute the procedure and will return an error.")),(0,a.kt)("h2",{id:"route-parameters"},"Route Parameters"),(0,a.kt)("p",null,"Like most web frameworks, SQListe allows you to define route patterns. This allows you to pass arguments directly in the route instead of using URI parameters or request body."),(0,a.kt)("p",null,"Exemple:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sql"},"-- Define the 'name' parameter in the route using curly braces\n-- #Route(\"/api/helloWorld/{name}\")\n-- #HttpGet(\"HelloWorld\")\nCREATE OR ALTER PROCEDURE [web].[p_hello_world] \n    @name NVARCHAR(100) -- Retrieve the parameter with the same name as the stored procedure argument\nAS \nBEGIN\n    DECLARE @response_body NVARCHAR(MAX);\n    \n    SELECT @response_body = 'Greetings, ' + @name + '!';\n        \n    SELECT \n         @response_body AS [response_body]\n        ,'text/plain' AS [response_content_type]\n        ,200 AS [response_status]\n    ;\nEND\nGO\n")),(0,a.kt)("admonition",{type:"note"},(0,a.kt)("p",{parentName:"admonition"},"It is possible to define multiple parameters in the route with different names."),(0,a.kt)("p",{parentName:"admonition"},"Like URI parameters, route parameters will be injected as NVARCHAR type.")),(0,a.kt)("admonition",{type:"caution"},(0,a.kt)("p",{parentName:"admonition"},"If a parameter name matches a reserved keyword, the reserved keyword takes precedence.")),(0,a.kt)("p",null,"In the above example, the parameter is considered required: if it is not provided, SQListe will not match this route.\nTo define an optional parameter, you can do the following:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sql"},"-- Define the 'name' parameter in the route using curly braces\n-- #Route(\"/api/helloWorld/{name?}\")\n-- #HttpGet(\"HelloWorld\")\nCREATE OR ALTER PROCEDURE [web].[p_hello_world] \n    @name NVARCHAR(100) = NULL -- Retrieve the parameter with the same name as the stored procedure argument, with a default value of NULL (useful if the parameter is not provided).\nAS \nBEGIN\n    DECLARE @response_body NVARCHAR(MAX);\n    \n    IF (@name IS NULL)\n        SET @response_body = 'Greetings, everyone!';\n    ELSE    \n        SELECT @response_body = 'Greetings, ' + @name + '!';\n        \n    SELECT \n         @response_body AS [response_body]\n        ,'text/plain' AS [response_content_type]\n        ,200 AS [response_status]\n    ;\nEND\nGO\n")),(0,a.kt)("p",null,"An optional parameter must be placed at the end of the route.\nFor example:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"/api/say/hello/{name?}/{age?}")," => Valid."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"/api/say/hello/{name}/withAge/{age?}")," => Valid."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"/api/say/hello/{name?}/withAge/{age?}")," => Invalid: correct functionality cannot be guaranteed.")),(0,a.kt)("p",null,"When dealing with multiple optional parameters, it is often better to use URI parameters as described earlier."),(0,a.kt)("admonition",{title:"Limitations",type:"warning"},(0,a.kt)("p",{parentName:"admonition"},"The length of a URI is limited to a maximum of 2048 characters. Problems may occur when reading parameters that exceed this limit."),(0,a.kt)("p",{parentName:"admonition"},(0,a.kt)("em",{parentName:"p"},"Some servers allow increasing this limit, but it is important to check whether the HTTP client/browser supports this increase."))))}u.isMDXComponent=!0}}]);